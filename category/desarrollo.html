<!DOCTYPE html>
<html lang="en">
<head>
        <title>pataliebre.net - desarrollo</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href=".././theme/css/main.css" type="text/css" />
        <link href=".././feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="pataliebre.net ATOM Feed" />
        

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href=".././css/ie.css"/>
                <script src=".././js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href=".././css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">

<a href="http://github.com/davidcaste/davidcaste.github.com">

<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />

</a>

        <header id="banner" class="body">
                <h1><a href="../.">pataliebre.net </a></h1>
                <nav><ul>
                
                
                
                    <li><a href=".././pages/about-me.html">acerca de mí</a></li>
                
                
                
                    <li class="active"><a href=".././category/desarrollo.html">desarrollo</a></li>
                
                    <li ><a href=".././category/general.html">general</a></li>
                
                </ul></nav>
        </header><!-- /#banner -->
                

            

        
        
            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href=".././control-de-concurrencia-usando-d-bus.html">Control de concurrencia usando D-Bus</a></h1> 
                    <footer class="post-info">
        <abbr class="published" title="2012-05-04T00:00:00">
                vie 04 mayo 2012
        </abbr>

        
        <address class="vcard author">
                By <a class="url fn" href=".././author/David Castellanos.html">David Castellanos</a>
        </address>
        
<p>In <a href=".././category/desarrollo.html">desarrollo</a>. </p>
<p>tags: <a href=".././tag/python.html">python</a><a href=".././tag/dbus.html">dbus</a><a href=".././tag/concurrencia.html">concurrencia</a></p>


</footer><!-- /.post-info --><p>Un problema frecuente es cómo impedir que un programa se ejecute dos o más
veces de forma concurrente. Uno de los mecanismos más utilizados para afrontar
este problema es el conocido como <a href="http://en.wikipedia.org/wiki/File_locking">file locking</a>. En un proyecto hemos
utilizado <a href="http://en.wikipedia.org/wiki/DBus">D-Bus</a> para implementar un mecanismo similar.</p>
<p>D-Bus es un sistema de bus de mensajes, una forma sencilla para que las
aplicaciones se comuniquen entre sí. De forma muy resumida (más información en
la web del <a href="http://www.freedesktop.org/wiki/Software/dbus">proyecto D-Bus</a>), cuando un usuario inicia una sesión gráfica en
el sistema tiene a su disposición un bus del sistema y un bus del usuario
ligado a su sesión. Un programa en ejecución se puede registrar en uno de estos
buses para ofrecer uno o más servicios, identificados unívocamente con un
identificador asignado por D-Bus (p.e. <code>:34-907</code>) y un nombre <em>conocido</em>
elegido por el programa (p.e. <code>es.foo.Bar</code>).</p>
<p>Puesto que sólo puede haber un único servicio en un bus con el mismo nombre, es
sencillo idear un mecanismo de control de concurrencia. Consistiría básicamente
en consultar si existe un servicio en el bus de sesión con un determinado
nombre. Un ejemplo sencillo implementado en Python es el siguiente:</p>
<div class="codehilite"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># dbus-singleton-example.py</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">gobject</span>
<span class="kn">import</span> <span class="nn">dbus</span>
<span class="kn">import</span> <span class="nn">dbus.mainloop.glib</span>
<span class="kn">import</span> <span class="nn">dbus.service</span>

<span class="n">BUS_NAME</span> <span class="o">=</span> <span class="s">&#39;es.foo.Bar&#39;</span>

<span class="k">class</span> <span class="nc">DBusSingleton</span><span class="p">(</span><span class="n">dbus</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">Object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bus</span> <span class="o">=</span> <span class="n">dbus</span><span class="o">.</span><span class="n">SessionBus</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bus</span><span class="o">.</span><span class="n">name_has_owner</span><span class="p">(</span><span class="n">BUS_NAME</span><span class="p">):</span>
            <span class="n">bus</span><span class="o">.</span><span class="n">request_name</span><span class="p">(</span><span class="n">BUS_NAME</span><span class="p">)</span>
            <span class="n">dbus</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">Object</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bus</span><span class="p">,</span> <span class="s">&#39;/es/foo/bar&#39;</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&#39;Adquired D-Bus name: &quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">BUS_NAME</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Failed to request D-Bus name: &quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">BUS_NAME</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">dbus</span><span class="o">.</span><span class="n">mainloop</span><span class="o">.</span><span class="n">glib</span><span class="o">.</span><span class="n">DBusGMainLoop</span><span class="p">(</span><span class="n">set_as_default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">singleton</span> <span class="o">=</span> <span class="n">DBusSingleton</span><span class="p">()</span>

    <span class="n">loop</span> <span class="o">=</span> <span class="n">gobject</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>


<p>Al ejecutarlo de forma concurrente <em>n</em> veces se obtiene la salida:</p>
<div class="codehilite"><pre><span class="nv">$ </span><span class="k">for </span>i in <span class="o">{</span>1..5<span class="o">}</span>; <span class="k">do </span>python dbus-concurrenty-example.py &amp; <span class="k">done</span>
Adquired D-Bus name: <span class="s2">&quot;es.foo.Bar&quot;</span>
Failed to request D-Bus name: <span class="s2">&quot;es.foo.Bar&quot;</span>
Failed to request D-Bus name: <span class="s2">&quot;es.foo.Bar&quot;</span>
Failed to request D-Bus name: <span class="s2">&quot;es.foo.Bar&quot;</span>
Failed to request D-Bus name: <span class="s2">&quot;es.foo.Bar&quot;</span>
</pre></div><p>There are <a href=".././control-de-concurrencia-usando-d-bus.html#disqus_thread">comments</a>.</p>
                </article>
                
            </aside><!-- /#featured -->
            
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                        <ol id="posts-list" class="hfeed">
            
        
        
        
        

        
         
            
            <li><article class="hentry">    
                <header>
                        <h1><a href=".././extraer-cadenas-de-un-fichero-ui-de-gtk-builder-con-intltool.html" rel="bookmark" title="Permalink to Extraer cadenas de un fichero .ui de gtk-builder con intltool">Extraer cadenas de un fichero .ui de gtk-builder con intltool</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2012-04-26T00:00:00">
                jue 26 abril 2012
        </abbr>

        
        <address class="vcard author">
                By <a class="url fn" href=".././author/David Castellanos.html">David Castellanos</a>
        </address>
        
<p>In <a href=".././category/desarrollo.html">desarrollo</a>. </p>
<p>tags: <a href=".././tag/gtk.html">gtk</a><a href=".././tag/autotools.html">autotools</a><a href=".././tag/intltool.html">intltool</a></p>


</footer><!-- /.post-info -->
                <p>Tenemos entre manos un proyecto en el que utilizamos Glade para la creación de
la interfaz de usuario; es muy cómodo porque crea una serie de ficheros XML que
describen la UI del programa, en lugar de crearla programáticamente. Hasta ahora
usábamos <code>libglade</code> para cargar estos ficheros, pero como esta ...</p>
                <a class="readmore" href=".././extraer-cadenas-de-un-fichero-ui-de-gtk-builder-con-intltool.html">read more</a>
                <p>There are <a href=".././extraer-cadenas-de-un-fichero-ui-de-gtk-builder-con-intltool.html#disqus_thread">comments</a>.</p>
                </div><!-- /.entry-content -->
            </article></li>
        
        
            
<p class="paginator">
    
    Page 1 / 1
    
</p>

        

    
    </ol><!-- /#posts-list -->
    </section><!-- /#content -->



        <section id="extras" class="body">
        
        
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>, which takes great advantages of <a href="http://python.org">python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-31198203-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>



<script type="text/javascript">
    var disqus_shortname = 'pataliebredotnet';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

</body>
</html>